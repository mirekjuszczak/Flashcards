# FlashCards Application - Models and Services Documentation

## Overview
This document describes the core models and services used in the FlashCards application, their responsibilities, and relationships.

---

## üöÄ RECENT CHANGES & DEVELOPMENT STATUS

### Last Significant Commit: 42ab1517c4ee11e8a32ed8bb95c620468a175d91
**Date:** 16 September 2025 at 09:29:39  
**Title:** "SingleCard and SingleCardDto Extentions added"

#### ‚úÖ COMPLETED FEATURES:

**1. Category CountCards & LastModified Update - PARTIALLY IMPLEMENTED**
- ‚úÖ **WORKING:** Updates `CountCards` and `LastModified` when **ADDING new cards**
- ‚úÖ **WORKING:** Proper validation and error handling in `FirebaseDatabaseService.UpdateCategoryCardCountAndDate()`
- ‚úÖ **WORKING:** Integration in `CreateCard()` method with category validation

**2. Showroom Firebase Integration**
- ‚úÖ **WORKING:** All Showroom pages work with Firebase (except DeleteAll in CardsCollection)
- ‚úÖ **WORKING:** Cards and Categories CRUD operations
- ‚úÖ **WORKING:** Real-time data loading and display
- ‚úÖ **WORKING:** Local cache with Firestore synchronization

**3. Authentication System**
- ‚úÖ **PLACEHOLDER:** Basic authorization page exists but not functional
- ‚úÖ **TEMPORARY:** Firestore access without authentication (time-limited access)

#### üî¥ CRITICAL ISSUES TO FIX:

**1. Missing CountCards & LastModified Updates:**
```csharp
// TODO: These operations DON'T update category metadata:
- DeleteCard() - Category.CountCards not decremented
- UpdateCardCategory() - Old/new category counts not updated
- DeleteAllCards() - All category counts not reset to 0
- DeleteAllCardsInCategory() - Category count not reset to 0
```

**2. DeleteAll in SampleCardsCollectionPageViewModel:**
- ‚ùå **NOT FINISHED:** DeleteAll button in CardsCollection Showroom page doesn't invoke updating of CoutCards and LastModified properties in categories 
- ‚ùå **ISSUE:** Category metadata not updated after bulk deletion

#### üõ†Ô∏è NEXT TASKS - HIGH PRIORITY:

**1. Fix Category Metadata Updates (CRITICAL)**
```csharp
// Need to add UpdateCategoryCardCountAndDate() calls in:
- DeleteCard() ‚Üí decrement CountCards by -1
- UpdateCardCategory() ‚Üí decrement old category, increment new category  
- DeleteAllCards() ‚Üí reset all categories CountCards to 0
- DeleteAllCardsInCategory() ‚Üí reset specific category CountCards to 0
```
**3. Fix DeleteAll Functionality**
- Investigate why DeleteAll doesn't work in CardsCollection Showroom
- Ensure proper category metadata updates during bulk operations

**4. Complete Authentication System**
- Replace placeholder with real Firebase Authentication
- Implement user-specific data isolation
- Remove temporary unrestricted Firestore access

#### üìã INTERFACE IMPLEMENTATION STATUS:

**IDatabaseService (FirebaseDatabaseService) - Status:**
- ‚úÖ **COMPLETE:** All interface methods implemented
- ‚ùå **INCOMPLETE:** Category metadata updates missing in delete/update operations

**IFlashcardsDataService (FlashcardsDataService) - Status:**
- ‚úÖ **COMPLETE:** All interface methods implemented
- ‚úÖ **WORKING:** Local cache + Firestore synchronization
- ‚ùå **DEPENDENCY:** Relies on IDatabaseService fixes for full functionality

**IUserService - Status:**
- ‚ùå **NOT IMPLEMENTED:** Interface and implementation missing
- ‚ùå **PLACEHOLDER:** Only basic authorization page exists

---
## üöÄ APPICATION'S ARCHITECTURE OVERVIEW

## Models

### SingleCard
**File:** `FlashCards/Models/SingleCard.cs`

**Purpose:** Core model representing a single flashcard in the application.

**Properties:**
- `Id` - Unique identifier (auto-generated by Firestore)
- `Phrase` - The main text/word to learn (required)
- `Translation` - Translation of the phrase (required)
- `Example` - Optional example sentence showing usage
- `CategoryId` - Reference to the category this card belongs to (empty string = undefined category)
- `LearningProgress` - Current learning status (NotStarted, InProgress, Learned, Mastered)
- `Favourite` - Boolean flag indicating if card is marked as favorite

**Firebase Integration:** Uses Firestore attributes for database mapping (`[FirestoreProperty]`, `[FirestoreDocumentId]`).

**Usage:** Primary entity for flashcard data, used throughout the application for CRUD operations.

---

### Category
**File:** `FlashCards/Models/Category.cs`

**Purpose:** Represents a category/group for organizing flashcards.

**Properties:**
- `Id` - Unique identifier (auto-generated by Firestore)
- `Name` - Display name of the category (required, unique)
- `CountCards` - Number of cards in this category (maintained automatically)
- `LastModified` - Timestamp of last modification (updated automatically)

**Firebase Integration:** Uses Firestore attributes for database mapping.

**Usage:** Organizational structure for grouping related flashcards. Cards can belong to one category or be uncategorized.

---

### SingleCardDto
**File:** `FlashCards/Models/Dto/SingleCardDto.cs`

**Purpose:** Data Transfer Object that combines SingleCard with enriched category information.

**Properties:** All properties from SingleCard plus:
- `CategoryName` - Resolved category name (avoids additional database calls)

**Key Methods:**
- `FromCardAndCategory(SingleCard, Category?)` - Static factory method to create DTO
- `ToSingleCard()` - Converts DTO back to SingleCard model

**Usage:** Used in ViewModels and UI to display cards with category names without requiring multiple database queries. Optimizes performance by pre-loading category information.

---

### FlashcardsData
**File:** `FlashCards/Models/FlashcardsData.cs`

**Purpose:** Container class that holds both Cards and Categories collections in memory for efficient local operations.

**Properties:**
- `Cards` - ObservableCollection of SingleCard objects
- `Categories` - ObservableCollection of Category objects

**Key Methods:**
- `GetCardsByCategory(categoryId)` - Filters cards by category
- `GetCategory(categoryId)` - Finds category by ID
- `GetCardsWithCategoryInfo()` - Returns all cards as DTOs with category info
- `GetFavoriteCards()` - Returns favorite cards
- `GetCardsByLearningProgress(progress)` - Filters by learning status
- `AddCard(card)`, `RemoveCard(cardId)` - Collection management
- `UpdateCardCategory(cardId, newCategoryId)` - Updates card's category

**Usage:** Provides local-first data access with efficient in-memory operations. Used by IFlashcardsDataService for caching and reducing database calls.

---

## Services

### IDatabaseService
**File:** `FlashCards/Services/DatabaseService/IDatabaseService.cs`  
**Implementation:** `FirebaseDatabaseService` (`FlashCards/Services/FirebaseService/FirestoreDatabaseService/FirebaseDatabaseService.cs`)

**Purpose:** Low-level database abstraction layer providing direct CRUD operations on Firestore.

**Responsibilities:**

#### Category Operations:
- `CreateCategory(name)` - Creates new category
- `GetCategory(categoryId)`, `GetCategoryByName(name)` - Retrieves categories
- `GetCategoriesCollection()` - Gets all categories
- `UpdateCategory(categoryId, newName)` - Updates category name
- `DeleteCategory(categoryId)`, `DeleteAllCategories()` - Deletion operations
- `CategoryExists(categoryId)` - Existence check

#### Card Operations:
- `CreateCard(card)` - Creates new flashcard
- `GetCard(cardId)` - Retrieves single card
- `GetCardsCollection()` - Gets all cards
- `GetCardsCollectionByCategroryId(categoryId)` - Gets cards by category
- `GetCardsWithUndefinedCategory()` - Gets uncategorized cards
- `GetFavoriteCards()`, `GetCardsByLearningProgress(progress)` - Filtered retrieval
- `UpdateCard(cardId, updatedCard)` - Full card update
- `UpdateCardCategory(cardId, categoryId)` - Category assignment
- `UpdateCardLearningProgress(cardId, progress)` - Learning status update
- `ToggleCardFavorite(cardId)` - Favorite toggle
- `DeleteCard(cardId)`, `DeleteAllCards()` - Deletion operations

#### Bulk Operations:
- `CreateMultipleCards(cards)` - Batch card creation
- `DeleteMultipleCards(cardIds)` - Batch deletion

**Implementation Details:**
- Direct Firestore integration using Plugin.Firebase.Firestore
- Error handling with null returns for failures
- Automatic category card count maintenance
- Validation of category existence before card operations

---

### IFlashcardsDataService
**File:** `FlashCards/Services/FlashcardsDataService/IFlashcardsDataService.cs`  
**Implementation:** `FlashcardsDataService` (referenced in your code)

**Purpose:** High-level service providing local-first data management with automatic Firestore synchronization.

**Responsibilities:**

#### Data Management:
- `Data` - Exposes FlashcardsData container for direct access
- `IsLoaded` - Indicates if data has been loaded from database
- `LoadDataAsync()` - Initial data load from Firestore
- `RefreshDataAsync()` - Refreshes local cache from Firestore

#### Card Operations (Local + Sync):
- `AddCardAsync(card)` - Adds card locally and syncs to Firestore
- `UpdateCardAsync(card)` - Updates card locally and syncs to Firestore
- `DeleteCardAsync(cardId)` - Deletes card locally and syncs to Firestore
- `DeleteAllCardsAsync()` - Bulk deletion with sync
- `UpdateCardCategoryAsync(cardId, newCategoryId)` - Category update with sync

#### Category Operations (Local + Sync):
- `AddCategoryAsync(categoryName)` - Adds category locally and syncs
- `UpdateCategoryAsync(categoryId, newName)` - Updates category locally and syncs
- `DeleteCategoryAsync(categoryId)` - Deletes category locally and syncs
- `DeleteAllCategoriesAsync()` - Bulk deletion with sync

#### DTO Methods (Local Operations):
- `GetCardsAsDto()` - All cards as DTOs with category info
- `GetCardsByCategoryAsDto(categoryId)` - Category-filtered DTOs
- `GetCardsWithUndefinedCategoryAsDto()` - Uncategorized cards as DTOs
- `GetFavoriteCardsAsDto()` - Favorite cards as DTOs
- `GetCardsByLearningProgressAsDto(progress)` - Progress-filtered DTOs

**Architecture Benefits:**
- **Local-First:** Fast operations using in-memory FlashcardsData
- **Automatic Sync:** Changes are automatically persisted to Firestore
- **Performance:** Reduces database calls through caching
- **Consistency:** Maintains data consistency between local cache and database
- **UI-Friendly:** Provides DTOs with pre-loaded category information

---

### IUserService
**Status:** NOT PREPARED  
**Purpose:** Intended for user authentication and user-specific data management.

**Expected Responsibilities:**
- User authentication (login/logout)
- User profile management
- User-specific data isolation
- Session management
- User preferences

---

## Service Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ViewModels    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ IFlashcardsData     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ IDatabaseService‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ Service             ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ - UI Logic      ‚îÇ    ‚îÇ                     ‚îÇ    ‚îÇ - Direct DB     ‚îÇ
‚îÇ - Data Binding  ‚îÇ    ‚îÇ - Local Cache       ‚îÇ    ‚îÇ   Operations    ‚îÇ
‚îÇ - Commands      ‚îÇ    ‚îÇ - Sync Management   ‚îÇ    ‚îÇ - Firestore     ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ - DTO Conversion    ‚îÇ    ‚îÇ   Integration   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ FlashcardsData  ‚îÇ
                       ‚îÇ                 ‚îÇ
                       ‚îÇ - In-Memory     ‚îÇ
                       ‚îÇ   Collections   ‚îÇ
                       ‚îÇ - Fast Access   ‚îÇ
                       ‚îÇ - Relationships ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Data Flow

1. **Initialization:** `IFlashcardsDataService.LoadDataAsync()` loads all data from Firestore into `FlashcardsData`
2. **Read Operations:** ViewModels use DTO methods for fast local data access
3. **Write Operations:** ViewModels call service methods which update local cache and sync to Firestore
4. **UI Updates:** ObservableCollections in `FlashcardsData` automatically update bound UI elements


